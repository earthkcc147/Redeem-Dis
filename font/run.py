import discord
from discord.ext import commands
import asyncio
import os

# р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ Intent
intents = discord.Intents.default()
intents.message_content = True
intents.voice_states = True  # р╣Гр╕лр╣Йр╕Ър╕нр╕Чр╕кр╕▓р╕бр╕▓р╕гр╕Цр╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕кр╕Цр╕▓р╕Щр╕░р╣Ар╕кр╕╡р╕вр╕Зр╣Др╕Фр╣Й

# р╕кр╕гр╣Йр╕▓р╕З Bot
bot = commands.Bot(command_prefix="!", intents=intents)

# р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╕Бр╕▓р╕гр╣Ар╕Ыр╕┤р╕Ф/р╕Ыр╕┤р╕Фр╕Яр╕╡р╣Ар╕Ир╕нр╕гр╣М
enable_features = True  # р╕Бр╕│р╕лр╕Щр╕Фр╣Ар╕Ыр╣Зр╕Щ True р╣Ар╕Юр╕╖р╣Ир╕нр╣Ар╕Ыр╕┤р╕Фр╕Яр╕╡р╣Ар╕Ир╕нр╕гр╣М р╕лр╕гр╕╖р╕н False р╣Ар╕Юр╕╖р╣Ир╕нр╕Ыр╕┤р╕Фр╕Яр╕╡р╣Ар╕Ир╕нр╕гр╣М

# р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╣Вр╕лр╕ер╕Ф Cogs
async def load_cogs():
    try:
        # р╣Вр╕Яр╕ер╣Ар╕Фр╕нр╕гр╣М cogs р╕бр╕╡р╣Др╕Яр╕ер╣М .py р╕Чр╕╡р╣Ир╕Ър╕нр╕Чр╕Ир╕░р╣Вр╕лр╕ер╕Ф
        cog_folder = "cogs"
        if os.path.exists(cog_folder):
            for filename in os.listdir(cog_folder):
                if filename.endswith(".py"):
                    cog_name = f"cogs.{filename[:-3]}"  # р╣Ар╕нр╕▓р╕Кр╕╖р╣Ир╕нр╣Др╕Яр╕ер╣Мр╕бр╕▓р╕кр╕гр╣Йр╕▓р╕Зр╣Ар╕Ыр╣Зр╕Щр╕Кр╕╖р╣Ир╕н Cog
                    if cog_name in bot.extensions:
                        await bot.unload_extension(cog_name)  # р╕лр╕▓р╕Б Cog р╕Цр╕╣р╕Бр╣Вр╕лр╕ер╕Фр╣Бр╕ер╣Йр╕зр╕Ир╕░р╕Чр╕│р╕Бр╕▓р╕гр╕Ыр╕ер╕Фр╣Вр╕лр╕ер╕Ф
                        print(f"ЁЯФ┤ Cog '{cog_name}' р╕Цр╕╣р╕Бр╕Ыр╕ер╕Фр╣Вр╕лр╕ер╕Фр╕Бр╣Ир╕нр╕Щр╕Чр╕╡р╣Ир╕Ир╕░р╕Чр╕│р╕Бр╕▓р╕гр╣Вр╕лр╕ер╕Фр╣Гр╕лр╕бр╣Ир╕Ир╕▓р╕Бр╣Др╕Яр╕ер╣М {filename}")
                    await bot.load_extension(cog_name)
                    print(f"тЬЕ Cog '{cog_name}' р╕Цр╕╣р╕Бр╣Вр╕лр╕ер╕Фр╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕вр╕Ир╕▓р╕Бр╣Др╕Яр╕ер╣М {filename}")
        else:
            print("тЭМ р╣Др╕бр╣Ир╕Юр╕Ър╣Вр╕Яр╕ер╣Ар╕Фр╕нр╕гр╣М 'cogs'")
    except Exception as e:
        print(f"тЭМ р╣Др╕бр╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Вр╕лр╕ер╕Ф Cogs: {e}")

@bot.event
async def on_ready():
    print(f"\nЁЯЪА р╕Ър╕нр╕Ч {bot.user} р╕Юр╕гр╣Йр╕нр╕бр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╣Бр╕ер╣Йр╕з!\n")
    print(f"ЁЯЖФ ID р╕Вр╕нр╕Зр╕Ър╕нр╕Ч: {bot.user.id}")
    print(f"ЁЯМН р╕Юр╕гр╣Йр╕нр╕бр╣Гр╕лр╣Йр╕Ър╕гр╕┤р╕Бр╕▓р╕гр╣Гр╕Щ {len(bot.guilds)} р╣Ар╕Лр╕┤р╕гр╣Мр╕Яр╣Ар╕зр╕нр╕гр╣М!\n")
    
    # р╣Бр╕кр╕Фр╕Зр╕Кр╕╖р╣Ир╕нр╕Вр╕нр╕Зр╣Ар╕Лр╕┤р╕гр╣Мр╕Яр╣Ар╕зр╕нр╕гр╣Мр╕Чр╕╡р╣Ир╕Ър╕нр╕Чр╣Ар╕Вр╣Йр╕▓р╕гр╣Ир╕зр╕б
    for guild in bot.guilds:
        print(f"ЁЯУб р╣Ар╕Лр╕┤р╕гр╣Мр╕Яр╣Ар╕зр╕нр╕гр╣Мр╕Чр╕╡р╣Ир╕Ър╕нр╕Чр╣Ар╕Вр╣Йр╕▓р╕гр╣Ир╕зр╕б: {guild.name} (ID: {guild.id})")
    
    print(f"\nтЬЕ р╕Бр╕▓р╕гр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╕Бр╕▒р╕Ъ Discord API р╕кр╕│р╣Ар╕гр╣Зр╕И\n")
    
    # р╣Ар╕кр╣Йр╕Щр╕Др╕▒р╣Ир╕Щ
    print("-" * 50)

    if enable_features:
        # р╕кр╕гр╣Йр╕▓р╕Зр╕лр╕бр╕зр╕Фр╕лр╕бр╕╣р╣И (category) р╣Гр╕лр╕бр╣Ир╕кр╕│р╕лр╕гр╕▒р╕Ъ BOT р╕лр╕▓р╕Бр╕вр╕▒р╕Зр╣Др╕бр╣Ир╕бр╕╡
        for guild in bot.guilds:
            category = discord.utils.get(guild.categories, name="BOT")
            if not category:
                # р╕кр╕гр╣Йр╕▓р╕Зр╕лр╕бр╕зр╕Фр╕лр╕бр╕╣р╣Ир╣Гр╕лр╕бр╣Ир╕лр╕▓р╕Бр╣Др╕бр╣Ир╕бр╕╡
                category = await guild.create_category("BOT")
                print(f"тЬи р╕лр╕бр╕зр╕Фр╕лр╕бр╕╣р╣И 'BOT' р╕Цр╕╣р╕Бр╕кр╕гр╣Йр╕▓р╕Зр╣Гр╕Щр╣Ар╕Лр╕┤р╕гр╣Мр╕Яр╣Ар╕зр╕нр╕гр╣М {guild.name}")
            
            # р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕лр╣Йр╕нр╕Зр╣Ар╕кр╕╡р╕вр╕Зр╕зр╣Ир╕▓ "bot online" р╕бр╕╡р╕нр╕вр╕╣р╣Ир╕лр╕гр╕╖р╕нр╣Др╕бр╣И
            voice_channel = discord.utils.get(guild.voice_channels, name="bot online")
            if not voice_channel:
                # р╕кр╕гр╣Йр╕▓р╕Зр╕лр╣Йр╕нр╕Зр╣Ар╕кр╕╡р╕вр╕З "bot online" р╣Гр╕Щр╕лр╕бр╕зр╕Фр╕лр╕бр╕╣р╣И "BOT"
                voice_channel = await guild.create_voice_channel("bot online", category=category)
                print(f"ЁЯОд р╕лр╣Йр╕нр╕Зр╣Ар╕кр╕╡р╕вр╕З 'bot online' р╕Цр╕╣р╕Бр╕кр╕гр╣Йр╕▓р╕Зр╣Гр╕Щр╣Ар╕Лр╕┤р╕гр╣Мр╕Яр╣Ар╕зр╕нр╕гр╣М {guild.name}")
            else:
                print(f"тЬЕ р╕лр╣Йр╕нр╕Зр╣Ар╕кр╕╡р╕вр╕З 'bot online' р╕бр╕╡р╕нр╕вр╕╣р╣Ир╣Бр╕ер╣Йр╕зр╣Гр╕Щр╣Ар╕Лр╕┤р╕гр╣Мр╕Яр╣Ар╕зр╕нр╕гр╣М {guild.name}")

            # р╣Ар╕Вр╣Йр╕▓р╕гр╣Ир╕зр╕бр╕лр╣Йр╕нр╕Зр╣Ар╕кр╕╡р╕вр╕З "bot online" р╣Бр╕ер╕░р╕Ыр╕┤р╕Фр╣Др╕бр╕Др╣М
            try:
                # р╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╕Бр╕▒р╕Ър╕лр╣Йр╕нр╕Зр╣Ар╕кр╕╡р╕вр╕Зр╣Бр╕ер╕░р╕Ыр╕┤р╕Фр╣Др╕бр╕Др╣М
                await voice_channel.connect(self_mute=True)
                print(f"ЁЯФК р╕Ър╕нр╕Чр╣Ар╕Вр╣Йр╕▓р╕гр╣Ир╕зр╕бр╕лр╣Йр╕нр╕Зр╣Ар╕кр╕╡р╕вр╕З 'bot online' р╣Гр╕Щр╣Ар╕Лр╕┤р╕гр╣Мр╕Яр╣Ар╕зр╕нр╕гр╣М {guild.name} р╣Бр╕ер╕░р╕Ыр╕┤р╕Фр╣Др╕бр╕Др╣Мр╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕вр╣Бр╕ер╣Йр╕з")
            except Exception as e:
                print(f"тЭМ р╣Др╕бр╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Ар╕Вр╣Йр╕▓р╕гр╣Ир╕зр╕бр╕лр╣Йр╕нр╕Зр╣Ар╕кр╕╡р╕вр╕З 'bot online' р╣Гр╕Щр╣Ар╕Лр╕┤р╕гр╣Мр╕Яр╣Ар╕зр╕нр╕гр╣М {guild.name}: {e}")
    else:
        print("тЭМ р╕Бр╕▓р╕гр╕кр╕гр╣Йр╕▓р╕Зр╕лр╕бр╕зр╕Фр╕лр╕бр╕╣р╣Ир╣Бр╕ер╕░р╕лр╣Йр╕нр╕Зр╣Ар╕кр╕╡р╕вр╕Зр╕Цр╕╣р╕Бр╕Ыр╕┤р╕Фр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ")

    # р╣Ар╕кр╣Йр╕Щр╕Др╕▒р╣Ир╕Щ
    print("-" * 50)

# р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕лр╕ер╕▒р╕Бр╕кр╕│р╕лр╕гр╕▒р╕Ър╕гр╕▒р╕Щр╕Ър╕нр╕Ч
async def main():
    print("ЁЯФЧ р╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щр╕Бр╕▓р╕гр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╕Бр╕▒р╕Ъ Discord...\n")
    # р╣Вр╕лр╕ер╕Ф Cogs
    await load_cogs()
    print("ЁЯОо р╕Бр╕│р╕ер╕▒р╕Зр╕гр╕▒р╕Щр╕Ър╕нр╕Ч...\n")
    # р╕гр╕▒р╕Щр╕Ър╕нр╕Ч
    await bot.start("YOUR_BOT_TOKEN")

# р╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щр╣Вр╕Ыр╕гр╣Бр╕Бр╕гр╕б
if __name__ == "__main__":
    asyncio.run(main())